# WiFI-Localization

## WiFi定位流程分析

整个WiFi定位系统的工作流程如下：

### 1. 初始化阶段
- 创建ROS2节点，设置订阅者和发布者
- 加载OSM地图文件，解析多边形边缘和AP位置信息
- 加载估计的AP位置数据

### 2. 数据收集阶段
- 通过rss话题订阅WiFi信号强度(RSSI)数据
- 累积收集5个数据点后开始处理
- 计算每个MAC地址的平均RSSI值

### 3. 楼层确定
- 统计每个楼层检测到的MAC地址数量
- 选择MAC地址最多的楼层作为当前楼层

### 4. AP分组与位置准备
- 将相似MAC地址(除最后一位)的AP分为一组
- 计算每组AP的平均位置和RSSI值
- 准备用于定位计算的位置和信号强度数据

### 5. 初始位置估计
- 计算初始猜测位置(所有AP位置的平均值)
- 查找包含初始点的最小房间多边形
- 设置优化边界，确保初始猜测点在边界内
- 将RSSI值转换为距离
- 使用PointEstimator进行初始位置估计

### 6. 迭代优化阶段
- 进行多次迭代(默认10次)改进定位精度
- 检测每个AP信号是否穿过墙体
- 对穿墙信号应用衰减值(-15dB)
- 根据墙体衰减情况过滤AP
- 使用过滤后的AP重新估计位置

### 7. 结果处理与发布
- 计算最终估计坐标和房间位置
- 创建并发布WifiLocation消息
- 保存最新位置用于定期重发
- 可视化定位结果并保存图像

## 关键算法特点
- 空间约束：使用房间边界限制优化范围
- 墙体衰减考虑：检测信号穿墙并应用衰减值
- 迭代优化：通过多次迭代提高定位精度
- AP分组：将相似MAC地址的AP分组处理
- 可视化：生成包含AP、定位结果和房间边界的可视化图像

## 信号传播模型参数
- 优化后的RSSI参考值：-26.95
- 优化后的路径损耗指数：2.82
- 墙体衰减值：-15dB

## 修复问题
- 修复问题：确保初始猜测点在优化边界内，避免优化算法因初始点超出边界而失败。这对于处理不同数据集中可能出现的AP位置与房间边界不匹配的情况非常重要。